<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Salesforce OAuth Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
  <div class="max-w-xl mx-auto bg-white p-8 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold mb-6 text-center">Salesforce Access Token Generator</h1>

    <div class="space-y-4">
      <input id="clientId" type="text" placeholder="Client ID" class="border p-2 w-full rounded">
      <input id="redirectUri" type="hidden" value="{{ redirect_uri }}">
      <input id="authCode" type="text" placeholder="Paste Decoded Authorization Code Here" class="border p-2 w-full rounded">
    </div>

    <div class="flex flex-wrap gap-4 mt-6 justify-center">
      <button onclick="openAuthWindow()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
        Get Authorization Code
      </button>
      <button onclick="getAccessToken()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
        Get Access Token
      </button>
    </div>
  </div>

  <script>
    function openAuthWindow() {
      const clientId = document.getElementById('clientId').value.trim();
      const redirectUri = document.getElementById('redirectUri').value.trim();
      if (!clientId || !redirectUri) {
        alert('Please enter Client ID.');
        return;
      }

      const authUrl = `https://login.salesforce.com/services/oauth2/authorize?response_type=code&client_id=${encodeURIComponent(clientId)}&redirect_uri=${encodeURIComponent(redirectUri)}`;
      window.open(authUrl, '_blank');
    }

    async function getAccessToken() {
      const clientId = document.getElementById('clientId').value.trim();
      const redirectUri = document.getElementById('redirectUri').value.trim();
      const authCode = document.getElementById('authCode').value.trim();

      if (!clientId || !authCode) {
        alert('Please fill all fields including the decoded Authorization Code.');
        return;
      }

      const params = new URLSearchParams();
      params.append('grant_type', 'authorization_code');
      params.append('client_id', clientId);
      params.append('redirect_uri', redirectUri);
      params.append('code', authCode);

      try {
        const response = await fetch('https://login.salesforce.com/services/oauth2/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: params
        });

        const data = await response.json();

        if (data.access_token) {
          alert('✅ Access Token:\n\n' + data.access_token);
          console.log('Full response:', data);
        } else {
          alert('❌ Failed to get access token.\n\n' + JSON.stringify(data));
        }

      } catch (error) {
        console.error(error);
        alert('Error fetching access token.');
      }
    }
  </script>
</body>
</html>
